

INC_DIR := -I. `pkg-config --cflags systemc` `pkg-config --cflags archc` `pkg-config --cflags tlm`

LIB_SYSTEMC := `pkg-config --libs systemc`
LIB_ARCHC := `pkg-config --libs archc`
LIB_POWERSC := 
LIB_DWARF := 
LIBS := $(LIB_SYSTEMC) $(LIB_ARCHC) $(LIB_POWERSC) $(LIB_DWARF) -lm $(EXTRA_LIBS)
CC :=   g++
OPT :=   -O3
DEBUG :=   -g
OTHER := -std=c++11  -DAC_GUEST_BIG_ENDIAN  -Wno-deprecated
CFLAGS := $(DEBUG) $(OPT) $(OTHER)  

TARGET := mips

# These are the source files automatically generated by ArchC, that must appear in the SRCS variable
ACSRCS := mips300_arch.cpp mips300_arch_ref.cpp mips300.cpp mips800_arch.cpp mips800_arch_ref.cpp mips800.cpp



# These are the source files automatically generated  by ArchC that are included by other files in ACSRCS
ACINCS := $(TARGET)_isa_init.cpp


# These are the header files automatically generated by ArchC
ACHEAD := mips300_parms.H mips300_arch.H mips300_arch_ref.H mips300_isa.H mips300_bhv_macros.H  mips300_intr_handlers.H mips300_ih_bhv_macros.H mips300.H mips800_parms.H mips800_arch.H mips800_arch_ref.H mips800_isa.H mips800_bhv_macros.H  mips800_intr_handlers.H mips800_ih_bhv_macros.H mips800.H

# These are the library files provided by ArchC
# They are stored in the archc/lib directory
ACLIBFILES := ac_decoder_rt.o ac_module.o ac_mem.o ac_utils.o  ac_syscall.o ac_tlm2_port.o ac_tlm2_intr_port.o 


# These are the source files provided by the user + ArchC sources
SRCS := main.cpp $(ACSRCS)  mips300_syscall.cpp mips300_intr_handlers.cpp mips800_syscall.cpp mips800_intr_handlers.cpp



OBJS := $(SRCS:.cpp=.o)

EXE := $(TARGET).x

.SUFFIXES: .cc .cpp .o .x

all:  lib 

$(EXE): $(OBJS)
	$(CC) $(CFLAGS) $(INC_DIR) $(LIB_DIR) -o $@ $(OBJS) $(LIBS) 2>&1 | c++filt

# Copy from template if main.cpp not exist
main.cpp:
	cp main.cpp.tmpl main.cpp

# Copy from template if mips300_syscall.H not exist
mips300_syscall.H:
	cp mips300_syscall.H.tmpl mips300_syscall.H

# Copy from template if mips300_intr_handlers.cpp not exist
mips300_intr_handlers.cpp:
	cp mips300_intr_handlers.cpp.tmpl mips300_intr_handlers.cpp

# Copy from template if mips800_syscall.H not exist
mips800_syscall.H:
	cp mips800_syscall.H.tmpl mips800_syscall.H

# Copy from template if mips800_intr_handlers.cpp not exist
mips800_intr_handlers.cpp:
	cp mips800_intr_handlers.cpp.tmpl mips800_intr_handlers.cpp

lib: mips800.cpp mips300.cpp $(OBJS)
	ar r lib$(TARGET).a $(OBJS)

.cpp.o:
	$(CC) $(CFLAGS) $(INC_DIR) -c $<

.cc.o:
	$(CC) $(CFLAGS) $(INC_DIR) -c $<

clean:
	rm -f $(OBJS) *~ $(EXE) core *.o *.a 

model_clean:
	rm -f $(ACSRCS) $(ACHEAD) $(ACINCS) *.tmpl loader.ac 

sim_clean: clean model_clean

distclean: sim_clean
	rm -f main.cpp Makefile

